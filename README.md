# ğŸ–¥ï¸ Meat-A-Eye Backend

> FastAPI ê¸°ë°˜ AI ì¶”ë¡  í”„ë¡ì‹œ & ì¶•ì‚°ë¬¼ í†µí•© ë°ì´í„° í”Œë«í¼ â€” ì´ë ¥ì¶”ì , ì‹œì„¸ ì¡°íšŒ, ëƒ‰ì¥ê³  ê´€ë¦¬, LLM ë ˆì‹œí”¼ ìƒì„±

## ğŸ“‹ ëª©ì°¨

- [í”„ë¡œì íŠ¸ ê°œìš”](#í”„ë¡œì íŠ¸-ê°œìš”)
- [ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜](#ì‹œìŠ¤í…œ-ì•„í‚¤í…ì²˜)
- [API ì—”ë“œí¬ì¸íŠ¸](#api-ì—”ë“œí¬ì¸íŠ¸)
- [ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„](#ë°ì´í„°ë² ì´ìŠ¤-ì„¤ê³„)
- [í•µì‹¬ ì„œë¹„ìŠ¤](#í•µì‹¬-ì„œë¹„ìŠ¤)
- [AI ì„œë²„ í†µì‹ ](#ai-ì„œë²„-í†µì‹ )
- [ì™¸ë¶€ API ì—°ë™](#ì™¸ë¶€-api-ì—°ë™)
- [ì¸ì¦ ì‹œìŠ¤í…œ](#ì¸ì¦-ì‹œìŠ¤í…œ)
- [ì—ëŸ¬ í•¸ë“¤ë§](#ì—ëŸ¬-í•¸ë“¤ë§)
- [í”„ë¡œì íŠ¸ êµ¬ì¡°](#í”„ë¡œì íŠ¸-êµ¬ì¡°)
- [ì‹¤í–‰ ë°©ë²•](#ì‹¤í–‰-ë°©ë²•)

---

## í”„ë¡œì íŠ¸ ê°œìš”

Meat-A-Eye ë°±ì—”ë“œëŠ” í”„ë¡ íŠ¸ì—”ë“œì™€ AI ì„œë²„ ì‚¬ì´ì˜ **ì¤‘ì•™ í—ˆë¸Œ** ì—­í• ì„ í•©ë‹ˆë‹¤. AI ëª¨ë¸ì˜ ê³ ê¸° ë¶€ìœ„ ë¶„ë¥˜ ê²°ê³¼ë¥¼ ìˆ˜ì‹ í•˜ì—¬ ì˜ì–‘ ì •ë³´, ì‹œì„¸ ì •ë³´, ì´ë ¥ ì¶”ì  ë°ì´í„°ë¥¼ í†µí•© ì œê³µí•˜ê³ , ì‚¬ìš©ìì˜ ëƒ‰ì¥ê³  ê´€ë¦¬ì™€ LLM ê¸°ë°˜ ë ˆì‹œí”¼ ì¶”ì²œê¹Œì§€ í¬ê´„í•˜ëŠ” í’€ìŠ¤íƒ API ì„œë²„ì…ë‹ˆë‹¤.

### í•µì‹¬ ê¸°ëŠ¥

| ê¸°ëŠ¥ | ì„¤ëª… |
|------|------|
| **AI ë¶„ì„ í”„ë¡ì‹œ** | ì´ë¯¸ì§€ë¥¼ AI ì„œë²„ì— ì „ë‹¬í•˜ê³  ê²°ê³¼ì— ì˜ì–‘Â·ì‹œì„¸Â·ì´ë ¥ ì •ë³´ë¥¼ ê²°í•© |
| **ëƒ‰ì¥ê³  ê´€ë¦¬** | ê³ ê¸° ë³´ê´€ íŠ¸ë˜í‚¹, D-day ê´€ë¦¬, ìœ í†µê¸°í•œ ì•Œë¦¼ |
| **ì¶•ì‚°ë¬¼ ì´ë ¥ì¶”ì ** | êµ­ë‚´ì‚°(MTRACE) / ìˆ˜ì…ì‚°(meatwatch) ì´ë ¥ë²ˆí˜¸ ì¡°íšŒ |
| **ì‹œì„¸ ì¡°íšŒ** | KAMIS API ê¸°ë°˜ ì‹¤ì‹œê°„ ì¶•ì‚°ë¬¼ ë„ì†Œë§¤ ê°€ê²© |
| **ì˜ì–‘ ì •ë³´** | ì‹í’ˆì•ˆì „ë‚˜ë¼ API ì—°ë™, ë“±ê¸‰ë³„Â·ì„¸ë¶€ìœ„ë³„ ì˜ì–‘ ë°ì´í„° |
| **LLM ë ˆì‹œí”¼** | Gemini 2.5 Flash ê¸°ë°˜ AI ë ˆì‹œí”¼ ìƒì„±Â·ì €ì¥Â·ë¶ë§ˆí¬ |
| **Web Push ì•Œë¦¼** | VAPID ê¸°ë°˜ ìœ í†µê¸°í•œ ë§Œë£Œ ì•Œë¦¼ |
| **ê²ŒìŠ¤íŠ¸ ì‹œìŠ¤í…œ** | UUID ê¸°ë°˜ ê²ŒìŠ¤íŠ¸ ì„¸ì…˜ â†’ íšŒì›ê°€ì… ì‹œ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ |

---

## ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Meat-A-Eye System Architecture                   â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Next.js     â”‚â”€â”€â”€â”€â†’â”‚  FastAPI Backend     â”‚â”€â”€â”€â”€â†’â”‚  AI Server       â”‚   â”‚
â”‚  â”‚  Frontend    â”‚â†â”€â”€â”€â”€â”‚  (Port: 8000)        â”‚â†â”€â”€â”€â”€â”‚  (Port: 8001)    â”‚   â”‚
â”‚  â”‚  (Port:3000) â”‚     â”‚                     â”‚     â”‚  EfficientNet-B2 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚     â”‚  + EasyOCR       â”‚   â”‚
â”‚                       â”‚  â”‚ SQLAlchemy    â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                       â”‚  â”‚ Async ORM     â”‚  â”‚                            â”‚
â”‚                       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚                       â”‚          â”‚          â”‚â”€â”€â”€â”€â†’â”‚  External APIs    â”‚   â”‚
â”‚                       â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”  â”‚â†â”€â”€â”€â”€â”‚                  â”‚   â”‚
â”‚                       â”‚  â”‚   MySQL DB    â”‚  â”‚     â”‚  â€¢ KAMIS (ì‹œì„¸)    â”‚   â”‚
â”‚                       â”‚  â”‚              â”‚  â”‚     â”‚  â€¢ ì‹í’ˆì•ˆì „ë‚˜ë¼     â”‚   â”‚
â”‚                       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚     â”‚  â€¢ MTRACE (êµ­ë‚´)   â”‚   â”‚
â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â€¢ meatwatch     â”‚   â”‚
â”‚                                                   â”‚  â€¢ Gemini LLM    â”‚   â”‚
â”‚                                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## API ì—”ë“œí¬ì¸íŠ¸

### ì¸ì¦ (`/api/v1/auth/`)

| Method | Endpoint | Auth | ì„¤ëª… |
|--------|----------|------|------|
| `POST` | `/register` | - | íšŒì›ê°€ì… (ê²ŒìŠ¤íŠ¸ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ì§€ì›) |
| `POST` | `/signup` | - | íšŒì›ê°€ì… (ë³„ì¹­) |
| `POST` | `/login` | - | ë¡œê·¸ì¸ â†’ JWT ë°œê¸‰ + `mustResetPassword` í”Œë˜ê·¸ |
| `POST` | `/guest` | - | ê²ŒìŠ¤íŠ¸ ì„¸ì…˜ ìƒì„±/ì¬ì‚¬ìš© (UUID ê¸°ë°˜) |
| `POST` | `/web-push` | âœ… | Web Push VAPID êµ¬ë… ë“±ë¡ |
| `POST` | `/password-reset` | - | ì„ì‹œ ë¹„ë°€ë²ˆí˜¸ ì´ë©”ì¼ ë°œì†¡ (Gmail SMTP) |
| `POST` | `/password-change` | âœ… | ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ |

### AI ë¶„ì„ (`/api/v1/ai/`)

| Method | Endpoint | Auth | ì„¤ëª… |
|--------|----------|------|------|
| `POST` | `/analyze` | âœ… | ì´ë¯¸ì§€ ë¶„ì„ â†’ ë¶€ìœ„ íŒë³„ + ì˜ì–‘/ì‹œì„¸/ì´ë ¥ í†µí•© ì‘ë‹µ |
| `POST` | `/recipe` | âœ… | ëƒ‰ì¥ê³  ì¬ë£Œ ê¸°ë°˜ LLM ë ˆì‹œí”¼ ìƒì„± |
| `POST` | `/recipe-for-part` | - | íŠ¹ì • ë¶€ìœ„ ë ˆì‹œí”¼ ìƒì„± |
| `POST` | `/recipe-random` | âœ… | ëƒ‰ì¥ê³  ëœë¤ ì¬ë£Œ ë ˆì‹œí”¼ (ì†Œ/ë¼ì§€ í•„í„° ê°€ëŠ¥) |
| `POST` | `/recipe-random-any` | âœ… | ì „ì²´ ë¶€ìœ„ ëœë¤ ë ˆì‹œí”¼ |
| `POST` | `/recipe/save` | âœ… | ë ˆì‹œí”¼ ì €ì¥ (ë§ˆí¬ë‹¤ìš´ í˜•ì‹) |
| `GET` | `/recipe/saved` | âœ… | ì €ì¥ëœ ë ˆì‹œí”¼ ëª©ë¡ + ë¶ë§ˆí¬ ìƒíƒœ |
| `DELETE` | `/recipe/saved/{id}` | âœ… | ë ˆì‹œí”¼ ì‚­ì œ |
| `POST/DELETE` | `/recipe/saved/{id}/bookmark` | âœ… | ë¶ë§ˆí¬ í† ê¸€ |

### ëƒ‰ì¥ê³  (`/api/v1/fridge/`)

| Method | Endpoint | Auth | ì„¤ëª… |
|--------|----------|------|------|
| `GET` | `/list` | ì„ íƒ | ëƒ‰ì¥ê³  ì•„ì´í…œ ëª©ë¡ (D-day ì •ë ¬, ìƒíƒœ í•„í„°) |
| `POST` | `/item` | âœ… | ì•„ì´í…œ ì¶”ê°€ |
| `POST` | `/item-from-traceability` | âœ… | ì´ë ¥ ì •ë³´ ê¸°ë°˜ ì•„ì´í…œ ì¶”ê°€ |
| `PATCH` | `/{item_id}/status` | âœ… | ìƒíƒœ ë³€ê²½ (ë³´ê´€ â†” ì†Œë¹„) |
| `PATCH` | `/{item_id}` | âœ… | ì•„ì´í…œ ìˆ˜ì • (ë¶€ìœ„, ì´ë¦„, ì†Œë¹„ í¬ë§ì¼) |
| `DELETE` | `/{item_id}` | âœ… | ì•„ì´í…œ ì‚­ì œ |

### ì¶•ì‚°ë¬¼ ì •ë³´ (`/api/v1/meat/`)

| Method | Endpoint | Auth | ì„¤ëª… |
|--------|----------|------|------|
| `GET` | `/prices` | - | ì‹¤ì‹œê°„ KAMIS ì‹œì„¸ ì¡°íšŒ |
| `GET` | `/info/list` | - | 16ì¢… í‘œì¤€ ë¶€ìœ„ ëª©ë¡ |
| `GET` | `/nutrition` | - | ë¶€ìœ„ë³„ ì˜ì–‘ ì •ë³´ (ë“±ê¸‰ë³„ êµ¬ë¶„) |
| `GET` | `/info/{meat_id}` | - | ë¶€ìœ„ ìƒì„¸ ì •ë³´ |
| `GET` | `/info/part/{part_name}` | - | ì˜ì–‘ + ì‹œì„¸ í†µí•© ì¡°íšŒ |
| `GET` | `/traceability` | - | ì´ë ¥ë²ˆí˜¸/ë¬¶ìŒë²ˆí˜¸ ì¡°íšŒ (êµ­ë‚´/ìˆ˜ì… ìë™ ë¼ìš°íŒ…) |
| `GET` | `/traceability/bundle` | - | ìˆ˜ì… ë¬¶ìŒë²ˆí˜¸ ëª©ë¡ |

### ëŒ€ì‹œë³´ë“œ (`/api/dashboard/`)

| Method | Endpoint | Auth | ì„¤ëª… |
|--------|----------|------|------|
| `GET` | `/prices` | - | ì†Œ/ë¼ì§€/ìˆ˜ì… ê°€ê²© (ë“±ê¸‰Â·ì§€ì—­ë³„ ë³‘ë ¬ ì¡°íšŒ) |
| `GET` | `/prices/history` | - | ì£¼ê°„ ê°€ê²© ì¶”ì´ ì°¨íŠ¸ ë°ì´í„° |
| `GET` | `/popular-cuts` | - | ì¸ê¸° ë¶€ìœ„ TOP N (ì£¼ê°„ íŠ¸ë Œë“œ + ì‹œì„¸) |

### ë§ˆì´í˜ì´ì§€ (`/api/v1/my/`)

| Method | Endpoint | Auth | ì„¤ëª… |
|--------|----------|------|------|
| `GET` | `/profile` | âœ… | í”„ë¡œí•„ ì •ë³´ |
| `GET` | `/grass` | âœ… | í™œë™ íˆíŠ¸ë§µ (ì¼ë³„ ì¸ì‹ íšŸìˆ˜) |
| `GET` | `/consumption-stats` | âœ… | ë³´ê´€/ì†Œë¹„ í†µê³„ |

### ê²ŒìŠ¤íŠ¸ í˜¸í™˜ ë¶„ì„ (`/api/analyze`)

| Method | Endpoint | Auth | ì„¤ëª… |
|--------|----------|------|------|
| `POST` | `/analyze` | - | ê²ŒìŠ¤íŠ¸ ë¶„ì„ (ì¸ì¦ ë¶ˆí•„ìš”, `guest_id`ë¡œ ì‹ë³„, `asyncio.gather` ë³‘ë ¬ ì¡°íšŒ) |

---

## ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„

### ERD

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   members    â”‚     â”‚   fridge_items   â”‚     â”‚    meat_info    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)      â”‚â†â”€â”  â”‚ id (PK)          â”‚  â”Œâ”€â†’â”‚ id (PK)         â”‚
â”‚ email        â”‚  â”‚  â”‚ member_id (FK) â”€â”€â”‚â”€â”€â”˜  â”‚ part_name       â”‚
â”‚ password     â”‚  â”‚  â”‚ meat_info_id(FK)â”€â”‚â”€â”€â”€â”€â”€â”‚ category        â”‚
â”‚ nickname     â”‚  â”‚  â”‚ storage_date     â”‚     â”‚ calories        â”‚
â”‚ is_guest     â”‚  â”‚  â”‚ expiry_date      â”‚     â”‚ protein         â”‚
â”‚ guest_id     â”‚  â”‚  â”‚ status           â”‚     â”‚ fat             â”‚
â”‚ must_reset_pwâ”‚  â”‚  â”‚ trace_number     â”‚     â”‚ storage_guide   â”‚
â”‚ created_at   â”‚  â”‚  â”‚ grade            â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚ origin           â”‚
                  â”‚  â”‚ company_name     â”‚
                  â”‚  â”‚ custom_name      â”‚
                  â”‚  â”‚ desired_cons_dateâ”‚
                  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”œâ”€â”€â”‚ recognition_logs â”‚     â”‚   saved_recipes     â”‚
                  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                  â”‚  â”‚ id (PK)          â”‚  â”Œâ”€â”€â”‚ id (PK)             â”‚
                  â”‚  â”‚ member_id (FK)   â”‚  â”‚  â”‚ member_id (FK) â”€â”€â”  â”‚
                  â”‚  â”‚ image_url        â”‚  â”‚  â”‚ title             â”‚  â”‚
                  â”‚  â”‚ part_name        â”‚  â”‚  â”‚ content (markdown)â”‚  â”‚
                  â”‚  â”‚ confidence_score â”‚  â”‚  â”‚ source (enum)     â”‚  â”‚
                  â”‚  â”‚ illuminance      â”‚  â”‚  â”‚ used_meats (JSON) â”‚  â”‚
                  â”‚  â”‚ browser_agent    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                  â”‚                        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚ recipe_bookmarks    â”‚
                  â”œâ”€â”€â”‚ web_notificationsâ”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚  â”‚ id (PK)             â”‚
                  â”‚  â”‚ id (PK)          â”‚  â”‚  â”‚ member_id (FK) â”€â”€â”  â”‚
                  â”‚  â”‚ member_id (FK)   â”‚  â”‚  â”‚ saved_recipe_idâ”€â”€â”˜  â”‚
                  â”‚  â”‚ fridge_item_id   â”‚  â”‚  â”‚ created_at          â”‚
                  â”‚  â”‚ notification_typeâ”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚  â”‚ title / body     â”‚  â”‚
                  â”‚  â”‚ scheduled_at     â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚  â”‚ status           â”‚  â”‚  â”‚  market_prices      â”‚
                  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                  â”‚                        â”‚  â”‚ id (PK)             â”‚
                  â”œâ”€â”€â”‚web_push_subs    â”‚â”€â”€â”˜  â”‚ part_name           â”‚
                  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚ current_price       â”‚
                  â”‚  â”‚ endpoint         â”‚     â”‚ price_date          â”‚
                  â”‚  â”‚ p256dh_key       â”‚     â”‚ region / grade_code â”‚
                  â”‚  â”‚ auth_key         â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

### ì£¼ìš” ëª¨ë¸

| ëª¨ë¸ | í…Œì´ë¸” | í•µì‹¬ í•„ë“œ | ë¹„ê³  |
|------|--------|-----------|------|
| `Member` | `members` | email (unique), password (bcrypt), is_guest, guest_id (UUID) | Cascade delete: í•˜ìœ„ ëª¨ë“  ë°ì´í„° |
| `FridgeItem` | `fridge_items` | storage/expiry_date, status, trace_number, grade | D-day ê³„ì‚°, ìë™ ì•Œë¦¼ |
| `MeatInfo` | `meat_info` | part_name, category, ì˜ì–‘ì†Œ (Numeric 5,2) | 16ì¢… í‘œì¤€ ë¶€ìœ„ |
| `RecognitionLog` | `recognition_logs` | part_name, confidence_score, illuminance | í™œë™ íˆíŠ¸ë§µ ë°ì´í„° |
| `SavedRecipe` | `saved_recipes` | content (markdown), source (enum), used_meats (JSON) | LLM ìƒì„± ë ˆì‹œí”¼ |
| `MarketPrice` | `market_prices` | current_price, price_date, grade_code | API ìºì‹œ (ë‹¹ì¼/ì „ì¼) |
| `WebNotification` | `web_notifications` | notification_type, scheduled_at, status | ìœ í†µê¸°í•œ ì•Œë¦¼ |

---

## í•µì‹¬ ì„œë¹„ìŠ¤

### ì˜ì–‘ ì •ë³´ ì„œë¹„ìŠ¤ (`NutritionService`)

```
ìš”ì²­ â†’ ì‹í’ˆì•ˆì „ë‚˜ë¼ API í˜¸ì¶œ â†’ ë“±ê¸‰ë³„/ì„¸ë¶€ìœ„ë³„ íŒŒì‹± â†’ êµ¬ì¡°í™”ëœ ì˜ì–‘ ë°ì´í„° ë°˜í™˜
                                   â†“ (ì‹¤íŒ¨ ì‹œ)
                              DB meat_info í…Œì´ë¸” Fuzzy ë§¤ì¹­ â†’ Fallback ì‘ë‹µ
```

- ë“±ê¸‰ íŒŒì‹±: 1++, 1+, 1, 2, 3ë“±ê¸‰ ìë™ ë¶„ë¥˜
- ì„¸ë¶€ìœ„ íŒŒì‹±: `food_nm` í•„ë“œì—ì„œ ì„¸ë¶€ ë¶€ìœ„ëª… ì¶”ì¶œ
- êµ¬ì¡°: `{ "by_grade": [...], "default": {...} }`

### ì‹œì„¸ ì„œë¹„ìŠ¤ (`PriceService`)

```
ìš”ì²­ â†’ DB ìºì‹œ ì¡°íšŒ (ë‹¹ì¼/ì „ì¼) â†’ ìºì‹œ íˆíŠ¸ â†’ ì¦‰ì‹œ ë°˜í™˜
                                â†’ ìºì‹œ ë¯¸ìŠ¤ â†’ KAMIS API í˜¸ì¶œ â†’ DB ìºì‹œ ì €ì¥ â†’ ë°˜í™˜
                                              â†“ (ì‹¤íŒ¨ ì‹œ)
                                         Stale ìºì‹œ ë°˜í™˜ â†’ ê·¸ë˜ë„ ì—†ìœ¼ë©´ ì—ëŸ¬
```

- ë“±ê¸‰ ì •ê·œí™”: êµ­ë‚´ì‚° ì†Œê³ ê¸°ëŠ” grade code (01/02/03), ë¼ì§€Â·ìˆ˜ì…ì€ ë¹ˆê°’
- 3ë‹¨ê³„ Fallback: ë‹¹ì¼ ìºì‹œ â†’ API â†’ Stale ìºì‹œ

### ì´ë ¥ì¶”ì  ì„œë¹„ìŠ¤ (`TraceabilityService`)

```
ì´ë ¥ë²ˆí˜¸ ì…ë ¥
    â†“
íŒ¨í„´ ë¶„ì„ (TraceabilityRouter)
    â”œâ”€â”€ 12ìë¦¬ ìˆ«ì â†’ êµ­ë‚´ì‚° (MTRACE API)
    â”‚                   â†“ (502/503 ì‹œ)
    â”‚               ìˆ˜ì…ì‚°ìœ¼ë¡œ Retry (meatwatch API)
    â”œâ”€â”€ A + 19~29ìë¦¬ â†’ ìˆ˜ì…ì‚° (meatwatch API)
    â””â”€â”€ ê¸°íƒ€ â†’ ìˆ˜ì…ì‚° ì‹œë„
```

### LLM ë ˆì‹œí”¼ ì„œë¹„ìŠ¤

- **ëª¨ë¸:** Google Gemini 2.5 Flash
- **ì†ŒìŠ¤ ìœ í˜•:** `ai_random` | `fridge_random` | `fridge_multi` | `part_specific`
- **ì €ì¥ í˜•ì‹:** Markdown (title + content + used_meats JSON)
- **ë¶ë§ˆí¬:** íšŒì›ë³„ unique constraint (member_id, saved_recipe_id)

---

## AI ì„œë²„ í†µì‹ 

### ë¶„ì„ íë¦„

```
Frontend                  Backend                      AI Server
   â”‚                        â”‚                              â”‚
   â”‚  POST /api/analyze     â”‚                              â”‚
   â”‚  (image + mode)        â”‚                              â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚                              â”‚
   â”‚                        â”‚  POST /ai/analyze            â”‚
   â”‚                        â”‚  (image + mode)              â”‚
   â”‚                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚
   â”‚                        â”‚                              â”‚
   â”‚                        â”‚  {class_name, confidence,    â”‚
   â”‚                        â”‚   heatmap_image}             â”‚
   â”‚                        â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                        â”‚                              â”‚
   â”‚                        â”‚  asyncio.gather(             â”‚
   â”‚                        â”‚    nutrition_fetch,           â”‚
   â”‚                        â”‚    price_fetch,               â”‚
   â”‚                        â”‚    traceability_fetch         â”‚
   â”‚                        â”‚  )                           â”‚
   â”‚                        â”‚                              â”‚
   â”‚  {partName, confidence,â”‚                              â”‚
   â”‚   heatmap, nutrition,  â”‚                              â”‚
   â”‚   price, traceability} â”‚                              â”‚
   â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                              â”‚
```

### ì´ë¯¸ì§€ ê²€ì¦

| ì²´í¬ í•­ëª© | ê¸°ì¤€ | ì—ëŸ¬ |
|-----------|------|------|
| íŒŒì¼ í¬ê¸° | â‰¤ 5MB | 413 Payload Too Large |
| Content-Type | jpeg, png, webp | 415 Unsupported Media Type |
| AI ì‘ë‹µ | status 200 | 503 AI Server Unavailable |

---

## ì™¸ë¶€ API ì—°ë™

| ì„œë¹„ìŠ¤ | API | ìš©ë„ | Fallback |
|--------|-----|------|----------|
| **KAMIS** | ì¶•ì‚°ë¬¼ ë„ì†Œë§¤ê°€ê²© | ì‹¤ì‹œê°„ ì‹œì„¸ + ì£¼ê°„ ì¶”ì´ | DB ìºì‹œ (stale) |
| **ì‹í’ˆì•ˆì „ë‚˜ë¼** | ì‹í’ˆì˜ì–‘ì •ë³´ | ë“±ê¸‰ë³„ ì˜ì–‘ ë°ì´í„° | DB meat_info |
| **MTRACE** | ì¶•ì‚°ë¬¼ì´ë ¥ì œ | êµ­ë‚´ ì´ë ¥ì¶”ì  | ìˆ˜ì… APIë¡œ retry |
| **meatwatch** | ìˆ˜ì…ì¶•ì‚°ë¬¼ì´ë ¥ | ìˆ˜ì… ì´ë ¥ì¶”ì  | - |
| **Gemini** | 2.5 Flash LLM | AI ë ˆì‹œí”¼ ìƒì„± | - |
| **Gmail SMTP** | ì´ë©”ì¼ ë°œì†¡ | ì„ì‹œ ë¹„ë°€ë²ˆí˜¸ | - |

### ë¶€ìœ„ ì½”ë“œ ë§¤í•‘ (16ì¢… + ìˆ˜ì… 3ì¢…)

AI ëª¨ë¸ ì¶œë ¥ â†’ ë°±ì—”ë“œ í‘œì¤€ ë¶€ìœ„ëª… â†’ KAMIS ì½”ë“œ â†’ ì‹í’ˆì•ˆì „ë‚˜ë¼ ì½”ë“œì˜ 4ë‹¨ê³„ ë§¤í•‘ ì²´ê³„:

```python
AI_PART_TO_BACKEND = {
    "Beef_Ribeye": "beef_ribeye",       # ë“±ì‹¬
    "Beef_Sirloin": "beef_sirloin",     # ì±„ë
    "Beef_Tenderloin": "beef_tenderloin", # ì•ˆì‹¬
    "Beef_Chuck": "beef_chuck",         # ëª©ì‹¬
    "Beef_Brisket": "beef_brisket",     # ì–‘ì§€
    "Beef_Round": "beef_round",         # ìš°ë‘”
    "Beef_Rib": "beef_rib",             # ê°ˆë¹„
    "Beef_Shank": "beef_shank",         # ì‚¬íƒœ
    "Beef_Shoulder": "beef_shoulder",   # ì•ë‹¤ë¦¬
    "Pork_Belly": "pork_belly",         # ì‚¼ê²¹ì‚´
    "Pork_Loin": "pork_loin",           # ë“±ì‹¬
    "Pork_Tenderloin": "pork_tenderloin", # ì•ˆì‹¬
    "Pork_Ribs": "pork_ribs",           # ê°ˆë¹„
    "Pork_Neck": "pork_neck",           # ëª©ì‚´
    "Pork_PicnicShoulder": "pork_picnic_shoulder", # ì•ë‹¤ë¦¬
    "Pork_Ham": "pork_ham",             # ë’·ë‹¤ë¦¬
}
```

---

## ì¸ì¦ ì‹œìŠ¤í…œ

### JWT êµ¬ì„±

| í•­ëª© | ì„¤ì • |
|------|------|
| ì•Œê³ ë¦¬ì¦˜ | HS256 |
| Access Token ë§Œë£Œ | 7ì¼ |
| Guest Token ë§Œë£Œ | 1ì¼ |
| Claims | `sub` (member_id), `exp`, `iat`, `is_guest` |
| ë¹„ë°€ë²ˆí˜¸ í•´ì‹± | bcrypt (72-byte UTF-8 ê²½ê³„ ì•ˆì „ ì ˆë‹¨) |

### ì¸ì¦ ì˜ì¡´ì„±

| ì˜ì¡´ì„± | ë™ì‘ |
|--------|------|
| `get_current_user` | í•„ìˆ˜ ì¸ì¦ â€” í† í° ì—†ìœ¼ë©´ 401 |
| `get_current_user_optional` | ì„ íƒ ì¸ì¦ â€” í† í° ì—†ìœ¼ë©´ `None` (ê²ŒìŠ¤íŠ¸ í˜¸í™˜) |

### ê²ŒìŠ¤íŠ¸ â†’ íšŒì› ë§ˆì´ê·¸ë ˆì´ì…˜

```
ê²ŒìŠ¤íŠ¸ ì„¸ì…˜ (UUID) â†’ íšŒì›ê°€ì… ì‹œ guest_id ì „ë‹¬
    â†’ FridgeItem ì†Œìœ ê¶Œ ì´ì „ (member_id ì—…ë°ì´íŠ¸)
    â†’ RecognitionLog ì†Œìœ ê¶Œ ì´ì „
    â†’ ê¸°ì¡´ ê²ŒìŠ¤íŠ¸ ê³„ì • ë¹„í™œì„±í™”
```

---

## ì—ëŸ¬ í•¸ë“¤ë§

### ì „ì—­ ì˜ˆì™¸ ì²˜ë¦¬

| ì˜ˆì™¸ | ìƒíƒœ ì½”ë“œ | ì‘ë‹µ |
|------|-----------|------|
| `RequestValidationError` | 422 | í•œêµ­ì–´ ìƒì„¸ ë©”ì‹œì§€ + Pydantic ì—ëŸ¬ ëª©ë¡ |
| `Exception` (ì¼ë°˜) | 500 | Debug ëª¨ë“œ: `type: message`, Production: ì¼ë°˜ ë©”ì‹œì§€ |
| AI ì„œë²„ ì—°ê²° ì‹¤íŒ¨ | 503 | "AI ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤" |
| ì´ë¯¸ì§€ í˜•ì‹ ì˜¤ë¥˜ | 422 | "ì§€ì›ë˜ì§€ ì•ŠëŠ” ì´ë¯¸ì§€ í˜•ì‹ì…ë‹ˆë‹¤" |

### AI ì„œë²„ ëŒ€ì‘

```python
# 422 (ì´ë¯¸ì§€ ê²€ì¦ ì‹¤íŒ¨) â†’ í´ë¼ì´ì–¸íŠ¸ì— êµ¬ì²´ì  ì˜¤ë¥˜ ì „ë‹¬
# 503 (AI ì„œë²„ ë‹¤ìš´) â†’ fallback ë©”ì‹œì§€ + ì¬ì‹œë„ ì•ˆë‚´
# timeout â†’ httpx íƒ€ì„ì•„ì›ƒ ì„¤ì •ìœ¼ë¡œ graceful ì²˜ë¦¬
```

---

## í”„ë¡œì íŠ¸ êµ¬ì¡°

```
Meat_A_Eye-backend/
â”œâ”€â”€ README.md                           # ë³¸ ë¬¸ì„œ
â”œâ”€â”€ requirements.txt                    # ì˜ì¡´ì„± íŒ¨í‚¤ì§€
â”œâ”€â”€ run.py                              # Uvicorn ì„œë²„ ì—”íŠ¸ë¦¬í¬ì¸íŠ¸
â”‚
â”œâ”€â”€ meat_backend/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py                         # FastAPI ì•± íŒ©í† ë¦¬ (Lifespan, CORS, ë¼ìš°í„°)
â”‚   â”œâ”€â”€ apis.py                         # ì™¸ë¶€ API í†µí•© (KAMIS, ì‹í’ˆì•ˆì „ë‚˜ë¼, MTRACE, meatwatch)
â”‚   â”‚
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ settings.py                 # Pydantic Settings (.env ë¡œë“œ)
â”‚   â”‚   â”œâ”€â”€ database.py                 # SQLAlchemy 2.0 Async (aiomysql)
â”‚   â”‚   â”œâ”€â”€ cors.py                     # CORS ì„¤ì •
â”‚   â”‚   â””â”€â”€ timezone.py                 # KST íƒ€ì„ì¡´ ìœ í‹¸ë¦¬í‹°
â”‚   â”‚
â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â”œâ”€â”€ errors.py                   # ì „ì—­ ì˜ˆì™¸ í•¸ë“¤ëŸ¬ (422/500)
â”‚   â”‚   â””â”€â”€ jwt.py                      # JWT ì¸ì¦ + bcrypt ë¹„ë°€ë²ˆí˜¸ í•´ì‹±
â”‚   â”‚
â”‚   â”œâ”€â”€ models/                         # SQLAlchemy ORM ëª¨ë¸
â”‚   â”‚   â”œâ”€â”€ member.py                   # íšŒì› (ê²ŒìŠ¤íŠ¸ í¬í•¨)
â”‚   â”‚   â”œâ”€â”€ fridge_item.py              # ëƒ‰ì¥ê³  ì•„ì´í…œ
â”‚   â”‚   â”œâ”€â”€ meat_info.py                # ë¶€ìœ„ ì •ë³´ (16ì¢…)
â”‚   â”‚   â”œâ”€â”€ recognition_log.py          # AI ì¸ì‹ ë¡œê·¸
â”‚   â”‚   â”œâ”€â”€ market_price.py             # ì‹œì„¸ ìºì‹œ
â”‚   â”‚   â”œâ”€â”€ saved_recipe.py             # ì €ì¥ëœ ë ˆì‹œí”¼
â”‚   â”‚   â”œâ”€â”€ recipe_bookmark.py          # ë ˆì‹œí”¼ ë¶ë§ˆí¬
â”‚   â”‚   â””â”€â”€ web_notification.py         # ì•Œë¦¼ + Web Push êµ¬ë…
â”‚   â”‚
â”‚   â”œâ”€â”€ schemas/                        # Pydantic v2 ìš”ì²­/ì‘ë‹µ ìŠ¤í‚¤ë§ˆ
â”‚   â”‚   â”œâ”€â”€ auth.py                     # ì¸ì¦ ìŠ¤í‚¤ë§ˆ
â”‚   â”‚   â”œâ”€â”€ fridge.py                   # ëƒ‰ì¥ê³  ìŠ¤í‚¤ë§ˆ
â”‚   â”‚   â”œâ”€â”€ meat.py                     # ì¶•ì‚°ë¬¼ ì •ë³´ ìŠ¤í‚¤ë§ˆ
â”‚   â”‚   â”œâ”€â”€ ai.py                       # AI ë¶„ì„ ì‘ë‹µ ìŠ¤í‚¤ë§ˆ
â”‚   â”‚   â””â”€â”€ stats.py                    # í†µê³„ ìŠ¤í‚¤ë§ˆ
â”‚   â”‚
â”‚   â”œâ”€â”€ routes/                         # API ë¼ìš°í„°
â”‚   â”‚   â”œâ”€â”€ api.py                      # ê²ŒìŠ¤íŠ¸ í˜¸í™˜ ë¶„ì„ (/api/analyze)
â”‚   â”‚   â”œâ”€â”€ dashboard.py                # ëŒ€ì‹œë³´ë“œ (/api/dashboard/)
â”‚   â”‚   â””â”€â”€ v1/
â”‚   â”‚       â”œâ”€â”€ auth.py                 # ì¸ì¦ ë¼ìš°íŠ¸
â”‚   â”‚       â”œâ”€â”€ ai.py                   # AI ë¶„ì„ + ë ˆì‹œí”¼ ë¼ìš°íŠ¸
â”‚   â”‚       â”œâ”€â”€ fridge.py               # ëƒ‰ì¥ê³  CRUD ë¼ìš°íŠ¸
â”‚   â”‚       â”œâ”€â”€ meat.py                 # ì¶•ì‚°ë¬¼ ì •ë³´ ë¼ìš°íŠ¸
â”‚   â”‚       â”œâ”€â”€ my.py                   # ë§ˆì´í˜ì´ì§€ ë¼ìš°íŠ¸
â”‚   â”‚       â””â”€â”€ notifications.py        # ì•Œë¦¼ ë¼ìš°íŠ¸
â”‚   â”‚
â”‚   â”œâ”€â”€ services/                       # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì„œë¹„ìŠ¤
â”‚   â”‚   â”œâ”€â”€ nutrition_service.py        # ì˜ì–‘ ì •ë³´ (API-first, DB-fallback)
â”‚   â”‚   â”œâ”€â”€ price_service.py            # ì‹œì„¸ ì¡°íšŒ (Cache-first)
â”‚   â”‚   â”œâ”€â”€ traceability_service.py     # ì´ë ¥ì¶”ì  (êµ­ë‚´/ìˆ˜ì… ìë™ ë¼ìš°íŒ…)
â”‚   â”‚   â””â”€â”€ traceability.py             # Legacy í˜¸í™˜ ë˜í¼
â”‚   â”‚
â”‚   â””â”€â”€ utils/
â”‚       â””â”€â”€ email.py                    # ë¹„ë™ê¸° SMTP ì´ë©”ì¼ ë°œì†¡
â”‚
â”œâ”€â”€ scripts/                            # SQL ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸
â”‚   â”œâ”€â”€ alter_saved_recipes_table.sql
â”‚   â”œâ”€â”€ create_recipe_bookmarks_table.sql
â”‚   â”œâ”€â”€ create_saved_recipes_table.sql
â”‚   â””â”€â”€ seed_meat_info_17.sql
â”‚
â””â”€â”€ sql/                                # ìŠ¤í‚¤ë§ˆ ì •ì˜
    â”œâ”€â”€ meathub_tables.sql
    â”œâ”€â”€ schema.sql
    â””â”€â”€ migrations/
```

---

## ì‹¤í–‰ ë°©ë²•

### í™˜ê²½ ì„¤ì •

```bash
# ì˜ì¡´ì„± ì„¤ì¹˜
pip install -r requirements.txt

# .env íŒŒì¼ ì„¤ì • (í•„ìˆ˜)
cp .env.example .env
```

### `.env` í•„ìˆ˜ í•­ëª©

```env
# MySQL
MYSQL_HOST=localhost
MYSQL_PORT=3306
MYSQL_USER=root
MYSQL_PASSWORD=your_password
MYSQL_DATABASE=meathub

# JWT
JWT_SECRET=your_jwt_secret_key

# AI Server
AI_SERVER_URL=http://localhost:8001

# External APIs
KAMIS_CERT_KEY=your_kamis_key
KAMIS_CERT_ID=your_kamis_id
NUTRITION_API_KEY=your_nutrition_key
MTRACE_API_KEY=your_mtrace_key

# LLM
GEMINI_API_KEY=your_gemini_key

# SMTP (ì„ íƒ)
SMTP_EMAIL=your_email@gmail.com
SMTP_PASSWORD=your_app_password
```

### ì„œë²„ ì‹¤í–‰

```bash
python run.py
# â†’ http://[::]:8000 ì—ì„œ ì„œë²„ ì‹œì‘ (IPv4/IPv6 ë“€ì–¼ìŠ¤íƒ)
# â†’ Debug ëª¨ë“œ: auto-reload í™œì„±í™”
```

---

## ê¸°ìˆ  ìŠ¤íƒ

| ì˜ì—­ | ê¸°ìˆ  |
|------|------|
| **Framework** | FastAPI â‰¥ 0.109 |
| **ASGI Server** | Uvicorn (standard) |
| **ORM** | SQLAlchemy 2.0 (Async) + aiomysql |
| **Database** | MySQL |
| **Auth** | python-jose (JWT HS256) + passlib (bcrypt) |
| **Validation** | Pydantic v2 + pydantic-settings |
| **HTTP Client** | httpx (async) |
| **XML Parsing** | xmltodict |
| **Push** | pywebpush (VAPID) |
| **LLM** | Google Gemini 2.5 Flash (google-genai) |
| **Email** | smtplib (Gmail SMTP + STARTTLS) |
